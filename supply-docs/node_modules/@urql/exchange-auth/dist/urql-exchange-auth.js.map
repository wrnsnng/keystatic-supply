{"version":3,"file":"urql-exchange-auth.js","sources":["../src/authExchange.ts"],"sourcesContent":null,"names":["addAuthAttemptToOperation","operation","authAttempt","makeOperation","kind","context","authExchange","init","client","forward","bypassQueue","Set","retries","makeSubject","errors","retryQueue","Map","flushQueue","authPromise","undefined","queue","forEach","next","errorQueue","error","makeErrorResult","config","operations$","initAuth","Promise","resolve","then","mutate","query","variables","baseOperation","createRequestOperation","createRequest","toPromise","take","filter","result","key","_instance","onStart","addAuthToOperation","add","result$","appendHeaders","headers","fetchOptions","_config","catch","process","env","NODE_ENV","console","warn","refreshAuth","set","willAuthError","didAuthError","opsWithAuth$","Boolean","map","delete","has","merge","source"],"mappings":"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"}